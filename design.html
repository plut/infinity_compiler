<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Design goals - &#x60;simod&#x60; user documentation</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="workflow.html"><strong aria-hidden="true">1.</strong> Workflow for mod installation</a></li><li class="chapter-item expanded "><a href="lua.html"><strong aria-hidden="true">2.</strong> API for modders</a></li><li class="chapter-item expanded "><a href="design.html" class="active"><strong aria-hidden="true">3.</strong> Design goals</a></li><li class="chapter-item expanded "><a href="database.html"><strong aria-hidden="true">4.</strong> Internals: Database structure</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="resrefs.html"><strong aria-hidden="true">4.1.</strong> Resource identifiers and namespacing</a></li><li class="chapter-item expanded "><a href="strrefs.html"><strong aria-hidden="true">4.2.</strong> Game strings</a></li><li class="chapter-item expanded "><a href="translations.html"><strong aria-hidden="true">4.3.</strong> Translations</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">&#x60;simod&#x60; user documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="design-goals"><a class="header" href="#design-goals">Design goals</a></h1>
<p>Obviously, there already exists a perfectly fine tool for IE modding.
However, starting from scratch allows us to design
with a number of useful properties in mind.</p>
<h2 id="robustness"><a class="header" href="#robustness">Robustness</a></h2>
<h3 id="replacing-the-mod-stack-by-a-proper-database"><a class="header" href="#replacing-the-mod-stack-by-a-proper-database">Replacing the mod stack by a proper database</a></h3>
<p>The database offers at any given time a coherent view of all
currently-installed mods. Uninstalling a single mod can be done by
running a somewhat simple (set of) SQL <code>DELETE</code> statement(s).
In particular, this is very fast (quasi-constant time w.r.t the number of
mods installed) compared to WeiDU's stack model (when modifying a mod
deep down the stack requires recomputing the whole stack, which has O(n)
cost).</p>
<h3 id="easier-conflict-detection-between-mods"><a class="header" href="#easier-conflict-detection-between-mods">Easier conflict detection between mods</a></h3>
<p>With whole access to the database it becomes trivial to detect when two
mods are trying to access the same resource.</p>
<p>(This is still <strong>TODO</strong> however; mostly, we need to fix an interface
about what to do in the case of conflict).</p>
<h3 id="namespacing"><a class="header" href="#namespacing">Namespacing</a></h3>
<p>Identifiers for game resources and strings are abstracted as strings
and namespaced per mod component.
This completely removes the need for using mod prefixes
and fitting names in 8 bytes (minus the prefix).
(On the other hand, the namespace model still allow access to original
game resources, and even resources from other mods, when this is really
needed).</p>
<p>Moreover, this also circumvents
a number of “bad behaviours” by mod authors,
such as fully overwriting a game file
or using inconsistent case for file names.</p>
<h3 id="translations"><a class="header" href="#translations">Translations</a></h3>
<p>This tool uses <a href="https://www.gnu.org/software/gettext/manual/html_node/PO-Files.html"><code>.po</code>
files</a>
for string translations.
This format is easy to edit; a number of free and open source tools
exist, and even a plain text editor will work in most cases.
This format has also proven to be quite robust e.g. when strings evolve
between versions of software.
(This is in contrast with WeiDU's <code>.tra</code> files, which are very brittle:
a single missing translation when a mod is updating will crash the
component).</p>
<p><strong>TODO:</strong>
the translation manager also contains a number of features
making it easy to annotate syntactically ambiguous sentences
(e.g. “Guard” may be either a verb or a noun in English;
both cases have different translations in most languages).</p>
<h3 id="portability"><a class="header" href="#portability">Portability</a></h3>
<p>The tool is mostly written in Rust, which takes great pains to be as
portable as possible; and mod scripts written in Lua should be portable
by construction.</p>
<p>In particular, it is a design goal to prevent mod authors from needing to
run shell scripts or batch files (which is a nightmare from a maintenance
POV).</p>
<h2 id="ease-of-use"><a class="header" href="#ease-of-use">Ease-of-use</a></h2>
<h3 id="mod-writing-in-sql-or-lua"><a class="header" href="#mod-writing-in-sql-or-lua">Mod writing in SQL or Lua</a></h3>
<p>This tool offers two levels of API for accessing the database.
The first level is plain SQL given by the description of the database;
for instance, <code>UPDATE &quot;items&quot; SET &quot;enchantment&quot;=5 WHERE &quot;itemref&quot;='sw1h34'</code> is a perfectly valid mod and will update Albruin's
enchantment.</p>
<p>However, it is expected that most of mods will use
the higher level represented as <a href="https://www.lua.org/">Lua</a> scripts.
Indeed, this tools offer the option to run a Lua script in an environment
where a simplified API to the database is exposed.
For example, the following code has the same effect as the SQL statement
above:</p>
<pre><code class="language-lua">albruin = simod.item(&quot;sw1h34&quot;)
albruin.enchantment = 5
</code></pre>
<p>Lua is a easy-to-use programming language
(and definitely easier to handle for a beginner than WeiDU);
moreover, it is already the language used in some parts of the games
themselves.</p>
<p>The SQL interface also allows authors to write mods in any language
containing a library for SQL access.</p>
<h3 id="mod-manager"><a class="header" href="#mod-manager">Mod manager</a></h3>
<p><strong>TODO</strong>: define a common API from the Lua side for describing a mod +
metadata (author, description, compatibility list)
and write on the an interactive mod selection tool which uses this mod
database.</p>
<h2 id="performance"><a class="header" href="#performance">Performance</a></h2>
<p>Any single mod installation only accesses the SQLite database;
thus all work is deferred to SQLite, which is quite fast.
Access to the game files is done only once when compiling the full mod
database to the override directory.
Moreover, this tool supports differential compilation:
only those files which did change since the previous compilation
will be regenerated.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="lua.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="database.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="lua.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="database.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
