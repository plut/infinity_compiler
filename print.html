<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>&#x60;simod&#x60; user documentation</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="workflow.html"><strong aria-hidden="true">1.</strong> Workflow for mod installation</a></li><li class="chapter-item expanded "><a href="lua.html"><strong aria-hidden="true">2.</strong> API for modders</a></li><li class="chapter-item expanded "><a href="design.html"><strong aria-hidden="true">3.</strong> Design goals</a></li><li class="chapter-item expanded "><a href="database.html"><strong aria-hidden="true">4.</strong> Internals: Database structure</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="resrefs.html"><strong aria-hidden="true">4.1.</strong> Resource identifiers and namespacing</a></li><li class="chapter-item expanded "><a href="strrefs.html"><strong aria-hidden="true">4.2.</strong> Game strings</a></li><li class="chapter-item expanded "><a href="translations.html"><strong aria-hidden="true">4.3.</strong> Translations</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">&#x60;simod&#x60; user documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="workflow-for-mod-installation"><a class="header" href="#workflow-for-mod-installation">Workflow for mod installation</a></h1>
<h2 id="rough-workflow"><a class="header" href="#rough-workflow">Rough workflow</a></h2>
<ol>
<li><code>simod init</code> (run this only once): creates the database and fills it
using data from the Infinity Engine files (key/bif and existing
override files).</li>
<li><code>simod add *target*</code> (run this one for each mod component): installs a
mod component by running the mod script to modify the database.</li>
<li><code>simod save</code> (run this once the database has been modified): compiles
the changes from the database back to the game directory.</li>
</ol>
<p>See <code>simod --help</code> for (slightly) more details.</p>
<h2 id="current-status"><a class="header" href="#current-status">Current status</a></h2>
<blockquote>
<p>This tool is at the “proof-of-concept” stage.</p>
<p>Since a lot of the infrastructure is still being built,
its capabilities are very restricted: it can only access and edit game
items.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="api-for-modders"><a class="header" href="#api-for-modders">API for modders</a></h1>
<p>TODO.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="design-goals"><a class="header" href="#design-goals">Design goals</a></h1>
<p>Obviously, there already exists a perfectly fine tool for IE modding.
However, starting from scratch allows us to design
with a number of useful properties in mind.</p>
<h2 id="robustness"><a class="header" href="#robustness">Robustness</a></h2>
<h3 id="replacing-the-mod-stack-by-a-proper-database"><a class="header" href="#replacing-the-mod-stack-by-a-proper-database">Replacing the mod stack by a proper database</a></h3>
<p>The database offers at any given time a coherent view of all
currently-installed mods. Uninstalling a single mod can be done by
running a somewhat simple (set of) SQL <code>DELETE</code> statement(s).
In particular, this is very fast (quasi-constant time w.r.t the number of
mods installed) compared to WeiDU's stack model (when modifying a mod
deep down the stack requires recomputing the whole stack, which has O(n)
cost).</p>
<h3 id="easier-conflict-detection-between-mods"><a class="header" href="#easier-conflict-detection-between-mods">Easier conflict detection between mods</a></h3>
<p>With whole access to the database it becomes trivial to detect when two
mods are trying to access the same resource.</p>
<p>(This is still <strong>TODO</strong> however; mostly, we need to fix an interface
about what to do in the case of conflict).</p>
<h3 id="namespacing"><a class="header" href="#namespacing">Namespacing</a></h3>
<p>Identifiers for game resources and strings are abstracted as strings
and namespaced per mod component.
This completely removes the need for using mod prefixes
and fitting names in 8 bytes (minus the prefix).
(On the other hand, the namespace model still allow access to original
game resources, and even resources from other mods, when this is really
needed).</p>
<p>Moreover, this also circumvents
a number of “bad behaviours” by mod authors,
such as fully overwriting a game file
or using inconsistent case for file names.</p>
<h3 id="translations"><a class="header" href="#translations">Translations</a></h3>
<p>This tool uses <a href="https://www.gnu.org/software/gettext/manual/html_node/PO-Files.html"><code>.po</code>
files</a>
for string translations.
This format is easy to edit; a number of free and open source tools
exist, and even a plain text editor will work in most cases.
This format has also proven to be quite robust e.g. when strings evolve
between versions of software.
(This is in contrast with WeiDU's <code>.tra</code> files, which are very brittle:
a single missing translation when a mod is updating will crash the
component).</p>
<p><strong>TODO:</strong>
the translation manager also contains a number of features
making it easy to annotate syntactically ambiguous sentences
(e.g. “Guard” may be either a verb or a noun in English;
both cases have different translations in most languages).</p>
<h3 id="portability"><a class="header" href="#portability">Portability</a></h3>
<p>The tool is mostly written in Rust, which takes great pains to be as
portable as possible; and mod scripts written in Lua should be portable
by construction.</p>
<p>In particular, it is a design goal to prevent mod authors from needing to
run shell scripts or batch files (which is a nightmare from a maintenance
POV).</p>
<h2 id="ease-of-use"><a class="header" href="#ease-of-use">Ease-of-use</a></h2>
<h3 id="mod-writing-in-sql-or-lua"><a class="header" href="#mod-writing-in-sql-or-lua">Mod writing in SQL or Lua</a></h3>
<p>This tool offers two levels of API for accessing the database.
The first level is plain SQL given by the description of the database;
for instance, <code>UPDATE &quot;items&quot; SET &quot;enchantment&quot;=5 WHERE &quot;itemref&quot;='sw1h34'</code> is a perfectly valid mod and will update Albruin's
enchantment.</p>
<p>However, it is expected that most of mods will use
the higher level represented as <a href="https://www.lua.org/">Lua</a> scripts.
Indeed, this tools offer the option to run a Lua script in an environment
where a simplified API to the database is exposed.
For example, the following code has the same effect as the SQL statement
above:</p>
<pre><code class="language-lua">albruin = simod.item(&quot;sw1h34&quot;)
albruin.enchantment = 5
</code></pre>
<p>Lua is a easy-to-use programming language
(and definitely easier to handle for a beginner than WeiDU);
moreover, it is already the language used in some parts of the games
themselves.</p>
<p>The SQL interface also allows authors to write mods in any language
containing a library for SQL access.</p>
<h3 id="mod-manager"><a class="header" href="#mod-manager">Mod manager</a></h3>
<p><strong>TODO</strong>: define a common API from the Lua side for describing a mod +
metadata (author, description, compatibility list)
and write on the an interactive mod selection tool which uses this mod
database.</p>
<h2 id="performance"><a class="header" href="#performance">Performance</a></h2>
<p>Any single mod installation only accesses the SQLite database;
thus all work is deferred to SQLite, which is quite fast.
Access to the game files is done only once when compiling the full mod
database to the override directory.
Moreover, this tool supports differential compilation:
only those files which did change since the previous compilation
will be regenerated.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="internals-database-structure"><a class="header" href="#internals-database-structure">Internals: Database structure</a></h1>
<p><strong>ALL STRINGS ARE UTF-8</strong>. No exceptions; we live in the 21st century.</p>
<p>The exposed interface for accessing game objects is through a number of
views:</p>
<ul>
<li><code>items</code>, <code>item_abilities</code>, <code>item_effects</code> for game items,</li>
<li>(other views are <strong>TODO</strong>: we are building high rather than wide for
now).</li>
</ul>
<p>These views implement all the infrastructure necessary for inserting and
updating game objects; in case more detail is needed, see the
“Internals” section below.</p>
<p>This implies that game modding can be performed directly as SQL queries
on a small number of tables with structure mirroring that of game files.
An ad-hoc library is also being built to make this comfortable for mod
authors (TODO).</p>
<h2 id="resource-view"><a class="header" href="#resource-view">Resource view</a></h2>
<p>For each resource <code>X</code>:</p>
<ul>
<li><code>X</code> is the user-facing view of all resources (original and modded).
This is the</li>
<li><code>load_X</code> is the table of all original resources;</li>
<li><code>add_X</code> is the table of all mod-inserted resources;</li>
<li><code>edit_X</code> is the table of all mod changes on this resource;</li>
<li><code>save_X</code> is the view used for saving game resources.</li>
</ul>
<blockquote>
<p>In general, mods should only interact with the main view <code>X</code>.
The structure of all other views listed here is <strong>unstable</strong>.</p>
</blockquote>
<p>For top-level resources, a few additional tables are used to mark their
status in the database with respect to the override directory:</p>
<ul>
<li><code>dirty_X</code> is the table listing all resources which have been modified
and which need to be recompiled to <code>override</code>;</li>
<li><code>orphan_X</code> is the list of all resources which have been removed from
the database, but not yet from the <code>override</code> directory.</li>
</ul>
<p>A (large) number of triggers are attached to the main view <code>X</code>:</p>
<ul>
<li>attempts at modifying <code>X</code> are propagated back to the appropriate table
(either <code>add_X</code> or <code>edit_X</code>);</li>
<li>at the same time, modifying <code>X</code> records the resource as dirty in
<code>dirty_X</code>;</li>
<li>deleting entries from <code>X</code> marks resources as orphan in <code>orphan_X</code>.</li>
</ul>
<p>The <code>load_X</code> table always contains exactly the resources found in
<code>key/bif</code> and pre-existing override files.
This table is never touched again after it is built by <code>simod init</code>.</p>
<h2 id="game-lists-ids-files"><a class="header" href="#game-lists-ids-files">Game lists (<code>IDS</code> files)</a></h2>
<p>TODO.</p>
<h2 id="game-tables-2da-files"><a class="header" href="#game-tables-2da-files">Game tables (<code>2DA</code> files)</a></h2>
<p>TODO.</p>
<h2 id="scripts"><a class="header" href="#scripts">Scripts</a></h2>
<p>TODO.</p>
<h2 id="binary-resources"><a class="header" href="#binary-resources">Binary resources</a></h2>
<p><strong>TODO:</strong></p>
<p>Binary resources generally do not need concurrent access between various
mods and are not handled by the database.
Where a resref pointing to a binary resource is expected,
the database uses instead a string referring to a file in the filesystem.</p>
<p>When the database is saved to the filesystem,
the filename for these resources is translated to a resref
using the general algorithm;
this resref in turn gives the name of the override file
under which the resource will be saved.</p>
<h2 id="todo"><a class="header" href="#todo">TODO</a></h2>
<p>Special cases:</p>
<ul>
<li>dialog,</li>
<li>IDs,</li>
<li>2da,</li>
<li>script (de)compiling,</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="resource-identifiers-and-namespacing"><a class="header" href="#resource-identifiers-and-namespacing">Resource identifiers and namespacing</a></h1>
<p>In-game resources are identified by “resrefs”, which are 8-byte ASCII
strings.
These resrefs are also used as file names in the override directory,
which puts a number of additional constraints on allowed characters:
namely, the characters <code>&quot;+&lt;&gt;/\|?*:</code> are forbidden.</p>
<p>Inside the <code>simod</code> database however, resources are identified by
arbitrary strings (hereafter designated as “longrefs”).</p>
<h2 id="namespacing-1"><a class="header" href="#namespacing-1">Namespacing</a></h2>
<p>To protect from resource conflicts, mod components generally do not
access them globally.</p>
<p>To each mod component is attached a <em>namespace</em>, in the form of a string.
Whenever a mod accesses a resource identifier <code>R</code>
it is translated to a longref in the following way,
assuming that <code>N</code> is the current namespace.</p>
<ol>
<li>if the name <code>R</code> does not contain a slash character, then
the namespace <code>N</code> is prepended: the longref is thus <code>&quot;N/R&quot;</code>;</li>
<li>if <code>R</code> contains a slash, then it is assumed to be a fully-qualified
longref.</li>
<li>as a special case, resources from the base game are accessible
using the empty namespace, e.g. as <code>&quot;/sw1h01&quot;</code>.</li>
</ol>
<p>These rules allow referring to either a base game resource (case 3)
or a resource from another mod (case 2), while still providing namespace
separation by default (case 1).</p>
<h3 id="namespacing-and-storage"><a class="header" href="#namespacing-and-storage">Namespacing and storage</a></h3>
<p>When stored inside the database,
longrefs are stored as fully-qualified strings
(in the form <code>&quot;namespace/identifier&quot;</code>).
Original game resrefs are stored in their original form
as 8-byte strings.</p>
<h3 id="implicit-resref-access"><a class="header" href="#implicit-resref-access">Implicit resref access</a></h3>
<p><strong>TODO:</strong> the Lua interface has the following feature:
whenever a structure field is of the “resref” type,
it is possible to assign a full structure to this field;
this will result in the assignment being made
with the reference to this structure instead.</p>
<p>For instance,</p>
<pre><code class="language-lua">small_sword = simod.item(&quot;/sw1h01&quot;);
store.inventory:push(small_sword); -- only pushes the resref &quot;/sw1h01&quot;
</code></pre>
<h2 id="conversion-to-game-format"><a class="header" href="#conversion-to-game-format">Conversion to game format</a></h2>
<p>The resource identifier strings are converted to the resref format
when the database is saved to the filesystem.</p>
<p>More precisely, the <code>resref_dict</code> table contains a dictionary
between string identifiers and resrefs.
This table is filled by triggers: whenever a game value
pointing to a resource is modified,
the values <code>(&quot;long_resource_name&quot;, null)</code> are inserted.
As part of the <code>save</code> operation,
The compiler takes care of replacing all <code>null</code> fields by
game-unique resref as needed.</p>
<p>(These resrefs are deduced from the long resource name by truncating and
enumerating).</p>
<h3 id="internal-representation-of-resrefs-from-the-base-game"><a class="header" href="#internal-representation-of-resrefs-from-the-base-game">Internal representation of resrefs from the base game</a></h3>
<p>Internally, resrefs from the base game are imported untouched as
longrefs (no slash character is prepended; rule 3. above actually removes
the slash character).
This means that longrefs without a slash always designate base resources,
while longrefs with a slash always designate mod-owned resources.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="string-references"><a class="header" href="#string-references">String references</a></h1>
<p>In-game strings are collected in one or two files, <code>dialog.tlk</code> and
(depending on user language) <code>dialogF.tlk</code>,
and referred to by 4-byte integers (“strrefs”) in game structures.</p>
<blockquote>
<p>In the database, strings are identified by <strong>“native strings”</strong>,
which are arbitrary strings.
(The native string is usually the game string itself
in the mod's native language).</p>
</blockquote>
<h3 id="namespacing-2"><a class="header" href="#namespacing-2">Namespacing</a></h3>
<p>Since game strings are not used as references,
namespacing rules do not apply for native strings.
The only rule is that strings from different namespaces will never be merged.</p>
<h2 id="conversion-to-strref"><a class="header" href="#conversion-to-strref">Conversion to strref</a></h2>
<p>The <code>strref_dict</code> table is the dictionary
between native strings and strrefs.</p>
<p>The <code>new_strings</code> view is a list of all the native strings
introduced by currently installed mods,
together with their game flags (<strong>TODO</strong> explain why the flags).</p>
<p>As a part of the <code>save</code> operation,
the compiler rebuilds <code>strref_dict</code>
from the list of strings present in <code>new_strings</code>.
This procedure happens in two steps:</p>
<ol>
<li>entries absent from <code>new_strings</code>
and entries with a too-high <code>strref</code> value
are purged from the dictionary,</li>
<li>then entries form <code>new_strings</code> are inserted in <code>strref_dict</code>,
each one successively using the lowest available strref.</li>
</ol>
<p>For step 1:
Let \(C\) be the number of constant strrefs
(e.g. \(C=34000\) for a BG1EE install)
and \(S\) be the number of entries in <code>new_strings</code>.
Then the new resrefs need to be allocated in the interval
\([0,C+S-1]\).
This means that entries where \(\mathtt{strref} \geq C+S \)
need to be purged from the <code>strref_dict</code> table.</p>
<p>The <code>string_keys</code> view is used for sequential generation of strrefs.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="translations-1"><a class="header" href="#translations-1">Translations</a></h1>
<h2 id="language-identifiers"><a class="header" href="#language-identifiers">Language identifiers</a></h2>
<p>Languages are represented by their 5-letter name (as in <code>&quot;en_US&quot;</code>)
or, for female variants, by their 6-letter name (as in <code>&quot;fr_FRF&quot;</code>).</p>
<p>Inside the database, female variants are handled as
distinct languages from male variants;
however a number of rules exist </p>
<p>(The 5- or 6-letter language identifier is lossless from the game's
<code>&quot;dialog.tlk&quot;</code> path; this simplifies backups etc.)</p>
<h2 id="translations-2"><a class="header" href="#translations-2">Translations</a></h2>
<p>String translation is handled through the use of the <code>translations_X</code>
table, where <code>X</code> is a 5- or 6- language identifier.
This table contains data similar to the game's <code>.tlk</code> file,
except that it is indexed by native strings instead of strrefs.</p>
<p>Any native string absent from this dictionary is left untranslated;
only its markers (see below) are discarded.
This is intended as a sane default value where the player,
when a string has not (yet) been translated, will see the string in the
original language, which is most often English.</p>
<h2 id="markers"><a class="header" href="#markers">Markers</a></h2>
<p>Native strings can contain markers of the following form: <code>{?text}</code>.
Such markers are discarded when a native string is used as the default
value for a game string in the absence of an appropriate translation.</p>
<p>These markers, however, are seen by translators when translating the
native string to another game language; most tools will even highlight
them (these look like Python formatting parameters).
It is thus <strong>strongly recommended</strong> to include markers in native strings
to signal any possible grammatical ambiguity
including at least the following cases:</p>
<ul>
<li>distinguishing verbs from nouns etc.: <code>&quot;{?verb}guard&quot;</code> vs.
`&quot;{?noun}guard&quot;;</li>
<li>marking grammatical gender where it is not obvious:
e.g. <code>&quot;come here, my dear {?male}friend&quot;</code>.</li>
</ul>
<p>Keep in mind that translators, when translating a string,
will generally not have access to context beyond the string itself.
Make liberal use of markers to help them produce quality work.</p>
<h2 id="gendered-languages"><a class="header" href="#gendered-languages">Gendered languages</a></h2>
<p>When producing translations for gendered languages,
the general case is that a single translation will be produced
for both gender variants.</p>
<h3 id="gender-markers"><a class="header" href="#gender-markers">Gender markers</a></h3>
<p>The empty marker <code>{?}</code> is a special case.
Including this marker in a native string marks this string as
needing two translations for gendered languages.
This means that, while a single native string is present in the source file,
the translator will be prompted to translate two strings,
where the empty marker will be replaced by either <code>{?M}</code> or <code>{?F}</code>.</p>
<p>This marker has no special meaning for non-gendered languages;
in this case the translator will see only a single string,
still bearing its empty marker.</p>
<h2 id="conversion-to-strref-1"><a class="header" href="#conversion-to-strref-1">Conversion to strref</a></h2>
<p>Conversion between native strings and strref is performed iby the
<code>strref_dict</code> table in a way similar to the <code>resref_dict</code> table.
The algorithm for generating new strrefs is of course different (the
lowest available value is used).</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
    </body>
</html>
